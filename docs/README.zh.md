<!--
This file is generated by program.
DO NOT edit it directly. Edit docs/README.base.md instead.
-->

# ACandyï¼šä¸€ä¸ªç”œçš„æ„å»º HTML çš„ Lua æ¨¡å—

<div align="center">
<p>ğŸŒ <a href="../README.md">English</a> | <strong>ä¸­æ–‡</strong></p>

<p>
æœ¬é¡¹ç›®ä½¿ç”¨<a href="https://semver.org/lang/zh-CN/">è¯­ä¹‰åŒ–ç‰ˆæœ¬</a>
</p>
</div>

ACandy æ˜¯ä¸€ä¸ªæ„å»º HTML çš„çº¯ Lua æ¨¡å—ã€‚åˆ©ç”¨ Lua çš„è¯­æ³•ç³–å’Œå…ƒè¡¨ï¼ŒACandy æä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„ DSL æ¥ä» Lua æ„å»º HTMLã€‚

## ç„ä¸€ç„

```lua
local acandy = require 'acandy'
local a, some, Fragment = acandy.a, acandy.some, acandy.Fragment

local example = Fragment {
   a.h1['#top heading heading-1'] 'Hello!',
   a.div { class="container", style="margin: 0 auto;",
      a.p {
         'My name is ', a.dfn('ACandy'), ', a module for building HTML.',
         a.br,
         'Thank you for your visit.',
      },
      a.p 'visitors:',
      a.ul / some.li('Alice', 'Bob', 'Carol', '...'),
   },
}
print(example)
```

è¾“å‡ºï¼ˆç»è¿‡æ ¼å¼åŒ–ï¼‰ï¼š

```html
<h1 id="top" class="heading heading-1">Hello!</h1>
<div style="margin: 0 auto;" class="container">
   <p>
      My name is <dfn>ACandy</dfn>, a module for building HTML.<br>
      Thank you for your visit.
   </p>
   <p>visitors:</p>
   <ul>
      <li>Alice</li>
      <li>Bob</li>
      <li>Carol</li>
      <li>...</li>
   </ul>
</div>
```

è¿™ç¯‡æ–‡æ¡£ä¸­ï¼Œä»£è¡¨å…ƒç´ å±æ€§çš„å­—ç¬¦ä¸²ç”¨åŒå¼•å·ï¼Œå…¶ä»–å­—ç¬¦ä¸²ç”¨å•å¼•å·ï¼Œè¿™ä»…ä¸ºæˆ‘çš„ä¸ªäººä¹ æƒ¯ï¼Œä½ å¯ä»¥è‡ªè¡Œå†³å®šã€‚

## å¯¼å…¥

```lua
local acandy = require('acandy')
local a = acandy.a
```

`a` æ˜¯æ‰€æœ‰å…ƒç´ çš„å…¥å£ï¼Œè¿™æ˜¯å› ä¸ºï¼š

- `a` æ˜¯ ACandy çš„é¦–å­—æ¯ï¼›
- `a` å¾ˆçŸ­ï¼Œæ‰“èµ·æ¥æ–¹ä¾¿ï¼›
- <code>a.*xxx*</code> å¯ä»¥ç†è§£ä¸ºè‹±è¯­çš„â€œä¸€ä¸ª *xxx*â€ã€‚

## åˆ›å»ºå…ƒç´ 

```lua
local elem = a.p {
   class="my-paragraph", style="color: #114514;",
   'This sentence is inside a ', a.code('<p>'), ' element.',
}
print(elem)
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`a.p`æ˜¯ä¸€ä¸ªè¿”å›`<p>`å…ƒç´ çš„å‡½æ•°ï¼Œå‚æ•°ä¸ºä¸€ä¸ªè¡¨ï¼Œè¡¨çš„é”®å€¼å¯¹å’Œåºåˆ—åˆ†åˆ«è¡¨ç¤ºå…ƒç´ çš„å±æ€§å’Œå­ç»“ç‚¹ï¼Œå…¶ä»–å…ƒç´ åŒç†ã€‚è‹¥ä»…æœ‰ä¸€ä¸ªå­ç»“ç‚¹ä¸”ä¸éœ€è¦è®¾ç½®å±æ€§ï¼Œå¯ä»¥ç›´æ¥å°†è¯¥ç»“ç‚¹ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œæ‰€ä»¥ `a.code('...')` å’Œ `a.code({ '...' })` æ˜¯ç­‰ä»·çš„ã€‚

è¯¥ä»£ç çš„è¾“å‡ºï¼Œæ ¼å¼åŒ–åï¼ˆä¸‹åŒï¼‰å¦‚ä¸‹ã€‚

```html
<p class="my-paragraph" style="color: #114514;">
   This sentence is inside a <code>&lt;p&gt;</code> element.
</p>
```

> [!TIP]
>
> - ä½ ä¸éœ€è¦åœ¨å­—ç¬¦ä¸²ä¸­å¤„ç† HTML è½¬ä¹‰ã€‚å¦‚æœä¸æœŸæœ›è‡ªåŠ¨çš„è½¬ä¹‰ï¼Œå¯ä»¥å°†å†…å®¹æ”¾åœ¨ [`acandy.Raw`](#acandyraw) ä¸­ã€‚
> - å­ç»“ç‚¹å¹¶ä¸å¿…é¡»æ˜¯å…ƒç´ æˆ–å­—ç¬¦ä¸²â€”â€”è™½ç„¶è¿™é‡Œåªå±•ç¤ºäº†è¿™ä¸¤ç±»ï¼Œä¸€åˆ‡èƒ½ `tostring` çš„å€¼å‡å¯ä½œä¸ºå­ç»“ç‚¹ã€‚

å¯¹äº HTML å…ƒç´ ï¼Œ<code>a.*xxx*</code> æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œå› æ­¤ `a.div`ã€`a.Div`ã€`a.DIV`â€¦â€¦æ˜¯åŒä¸€ä¸ªå€¼ï¼Œå®ƒä»¬éƒ½å°†å˜æˆ`<div></div>`ã€‚è€Œå¯¹äºå…¶ä»–å…ƒç´ ï¼Œ<code>a.*xxx*</code> æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚

### å±æ€§

é€šè¿‡è¡¨çš„é”®å€¼å¯¹ä¸ºå…ƒç´ æä¾›å±æ€§ã€‚å€¼å¯ä»¥æ˜¯ä»¥ä¸‹å†…å®¹ï¼š

- `nil` å’Œ `false` è¡¨ç¤ºæ²¡æœ‰æ­¤å±æ€§ï¼›
- `true` è¡¨ç¤ºæ­¤ä¸ºå¸ƒå°”å€¼å±æ€§ï¼Œä¾‹å¦‚ï¼Œ`a.script { async=true }` è¡¨ç¤º `<script async></script>`ï¼›
- å…¶ä½™å€¼ï¼Œå°†ä¼šå¯¹å…¶ `tostring`ï¼Œå¹¶è½¬ä¹‰å…¶ä¸­çš„ `&`ã€`<`ã€`>` å’Œ NBSPã€‚

### å­ç»“ç‚¹

é€šè¿‡è¡¨çš„åºåˆ—éƒ¨åˆ†ä¸ºå…ƒç´ æä¾›å­ç»“ç‚¹ã€‚é™¤ `nil` ä¹‹å¤–çš„å€¼å‡å¯ä½œä¸ºå­ç»“ç‚¹ã€‚å½“åºåˆ—åŒ–æ—¶ï¼Œå®ƒä»¬éµå¾ªä»¥ä¸‹è§„åˆ™ã€‚

#### é»˜è®¤æƒ…å½¢

å…ƒç´ ã€å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰åæ–‡æ²¡æœ‰æåˆ°çš„å€¼å‡é€‚ç”¨äºä»¥ä¸‹è§„åˆ™ã€‚

åœ¨å…ƒç´ å­—ç¬¦ä¸²åŒ–æ—¶ï¼Œå¯¹è¿™äº›å€¼å°è¯• `tostring`ï¼Œå¹¶è½¬ä¹‰ `&`ã€`<`ã€`>` å’Œ NBSPã€‚å¦‚æœä¸æœŸæœ›è‡ªåŠ¨çš„è½¬ä¹‰ï¼Œå¯ä»¥å°†å†…å®¹æ”¾åœ¨ [`acandy.Raw`](#acandyraw) ä¸­ã€‚

åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸‰ä¸ªå…ƒç´ ï¼ˆ`<p>`ï¼‰ä½œä¸º `<article>` çš„å­ç»“ç‚¹ï¼Œå¹¶åˆ†åˆ«å°†å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ä½œä¸º `<p>` çš„å…ƒç´ ã€‚ç»“æœæ˜¾è€Œæ˜“è§ã€‚

```lua
local elem = a.article {
   a.p 'Lorem ipsum...',  -- or `a.p { 'Lorem ipsum...' }`
   a.p(2),  -- or `a.p { 2 }`
   a.p(true),  -- or `a.p { true }`
}
print(elem)
```

```html
<article>
   <p>Lorem ipsum...</p>
   <p>2</p>
   <p>true</p>
</article>
```

#### åˆ—è¡¨

åœ¨åºåˆ—åŒ–æ—¶ï¼Œå¦‚æœä¸€ä¸ªç»“ç‚¹æ˜¯[ç±»åˆ—è¡¨çš„](#ç±»åˆ—è¡¨å€¼)ï¼ŒACandy å°†é€’å½’åºåˆ—åŒ–åˆ—è¡¨ä¸­çš„å­ç»“ç‚¹ã€‚

é¡ºä¾¿ä¸€æï¼Œç”± [`acandy.Fragment`](#acandyfragment) è¿”å›çš„è¡¨ï¼ˆå¦‚ `Fragment { 1, 2, 3 }`ï¼‰æ˜¯ç±»åˆ—è¡¨çš„ï¼Œå› ä¸ºå®ƒä»¬çš„å…ƒè¡¨çš„ `'__acandy_list_like'` å­—æ®µè¢«è®¾ç½®ä¸º `true`ã€‚

ç‰¹åˆ«åœ°ï¼Œå¦‚æœä¸€ä¸ªè¡¨ä¸è¢«è®¤ä¸ºæ˜¯ç±»åˆ—è¡¨çš„ï¼Œå¦‚ `a.p { 1, 2, 3 }` è¿”å›çš„è¡¨ï¼Œæ ¹æ®[é»˜è®¤è§„åˆ™](é»˜è®¤æƒ…å½¢)ï¼Œå®ƒå°†ç›´æ¥é€šè¿‡ `tostring` è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç¡®ä¿å®ƒå®ç°äº† `__tostring` å…ƒæ–¹æ³•ã€‚

```lua
local list1 = { '3', '4' }
local list2 = { '2', list1 }
local elem = a.div { '1', list2 }
print(elem)
```

```html
<p>1234</p>
```

#### å‡½æ•°

å¯ä»¥å°†å‡½æ•°ä½œä¸ºå­ç»“ç‚¹ï¼Œè¿™ç›¸å½“äºè°ƒç”¨å‡½æ•°ï¼Œå¹¶å°†è¿”å›å€¼ä½œä¸ºå­ç»“ç‚¹ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå‡½æ•°å°†è¢«æ¨è¿Ÿåˆ° `tostring` æ—¶è°ƒç”¨ã€‚

```lua
local elem = a.ul {
   a.li 'item 1',
   a.li {
      function ()  -- returns string
         return 'item 2'
      end,
   },
   function ()  -- returns element
      return a.li 'item 3'
   end,
   function ()  -- returns list
      local list = {}
      for i = 4, 6 do
         list[#list+1] = a.li('item '..i)
      end
      return list
   end,
}
print(elem)
```

```html
<ul>
   <li>item 1</li>
   <li>item 2</li>
   <li>item 3</li>
   <li>item 4</li>
   <li>item 5</li>
   <li>item 6</li>
</ul>
```

> [!TIP]
>
> å­ç»“ç‚¹æ˜¯é€’å½’å¤„ç†çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨å‡½æ•°é‡Œè¿”å›å‡½æ•°ã€‚

### æ–¹æ‹¬å·è¯­æ³•ï¼ˆè®¾ç½®å…ƒç´ å±æ€§ï¼‰

åœ¨æ–¹æ‹¬å·å†…æ”¾ç½®å­—ç¬¦ä¸²å¯ä»¥å¿«é€Ÿè®¾ç½® `id` å’Œ `class`ã€‚

```lua
local elem = a.div['#my-id my-class-1 my-class-2'] {
   a.p 'You know what it is.',
}
print(elem)
```

åœ¨æ–¹æ‹¬å·å†…æ”¾ç½®[ç±»è¡¨å€¼](#ç±»è¡¨å€¼)å¯ä»¥è®¾ç½®å…ƒç´ å±æ€§ï¼Œå±æ€§ä¸å±€é™äº `id` å’Œ `class`ã€‚è¿™è®©å¤ç”¨å±æ€§å˜å¾—æ›´æ–¹ä¾¿ã€‚

```lua
local attr = {
   id="my-id",
   class="my-class-1 my-class-2",
}
local elem = a.div[attr] {
   a.p 'You know what it is.',
}
print(elem)
```

ä¸Šé¢ä¸¤æ®µä»£ç çš„è¾“å‡ºå‡ä¸ºï¼š

```html
<div id="my-id" class="my-class-1 my-class-2">
   <p>You know what it is.</p>
</div>
```

### æ–œæ è¯­æ³•ï¼ˆé¢åŒ…å±‘ï¼‰

```lua
elem1 / elem2 / ... / elemN / tail_value
```

ç›¸å½“äºï¼š

```lua
elem1(
   elem2(
      ...(
         elemN(tail_value)
      )
   )
)
```

æœ‰ç‚¹åƒ CSS çš„[å­ç»„åˆå™¨](https://developer.mozilla.org/docs/Web/CSS/Child_combinator) `>`ï¼Œåªä¸è¿‡å®ƒç”¨äºåˆ›å»ºå…ƒç´ è€Œä¸æ˜¯é€‰æ‹©å…ƒç´ ã€‚

å‰ææ˜¯ `<elem1>`ã€`<elem2>` ä¸æ˜¯[ç©ºå…ƒç´ ](https://developer.mozilla.org/docs/Glossary/Void_element)æˆ–[å·²æ„å»ºå…ƒç´ ](#å…ƒç´ å®ä¾‹å±æ€§)ã€‚

ä¾‹å­ï¼š

```lua
local link_item = a.li / a.a
local text = 'More coming soon...'
local elem = (
   a.header['site-header'] / a.nav / a.ul {
      link_item { href="/home", 'Home' },
      link_item { href="/posts", 'Posts' },
      link_item { href="/about", 'About' },
      a.li / text,
   }
)
print(elem)
```

```html
<header class="site-header">
   <nav>
      <ul>
         <li><a href="/home">Home</a></li>
         <li><a href="/posts">Posts</a></li>
         <li><a href="/about">About</a></li>
         <li>More coming soon...</li>
      </ul>
   </nav>
</header>
```

> [!TIP]
>
> é¢åŒ…å±‘å¯ä»¥ç¼“å­˜ï¼Œå°±åƒä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­çš„ `link_item`ã€‚

### `acandy.some`

```lua
local frag1 = some.<tag>(<arg1>, <arg2>, ...)
local frag2 = some.<tag>[<attr>](<arg1>, <arg2>, ...)
```

ç›¸å½“äºï¼š

```lua
local frag1 = Fragment {
   a.<tag>(<arg1>),
   a.<tag>(<arg2>),
   ...,
}
local frag2 = Fragment {
   a.<tag>[<attr>](<arg1>),
   a.<tag>[<attr>](<arg2>),
   ...,
}
```

ä¾‹å­ï¼š

```lua
local some = acandy.some
local items = a.ul {
   some.li['my-li']('item 1', 'item 2'),
   some.li('item 3', 'item 4'),
}
print(items)
```

```html
<ul>
   <li class="my-li">item 1</li>
   <li class="my-li">item 2</li>
   <li>item 3</li>
   <li>item 4</li>
</ul>
```

## å…ƒç´ å®ä¾‹

å¦‚æœä¸€ä¸ªå…ƒç´ æ˜¯ `a.div(...)`ã€`a.div[...](...)` è¿™ç±»è¿›è¡Œå‡½æ•°è°ƒç”¨å¾—å‡ºçš„å…ƒç´ ï¼Œåˆ™ç§°å®ƒä¸ºâ€œ**å·²æ„å»ºå…ƒç´ **â€ï¼ˆæš‚å®šï¼‰ï¼›å·²æ„å»ºå…ƒç´ ä½œä¸ºé¢åŒ…å±‘æœ«ç«¯çš„å…ƒç´ æ—¶ï¼Œè¯¥é¢åŒ…å±‘åŒæ ·è¿”å›ä¸€ä¸ªå·²æ„å»ºå…ƒç´ ï¼›è€Œ `a.div`ã€`a.div[...]` åˆ™ä¸å±äºå·²æ„å»ºå…ƒç´ ã€‚

å¯¹äºä¸€ä¸ªå·²æ„å»ºçš„å…ƒç´  `elem`ï¼Œå®ƒæœ‰å¦‚ä¸‹å±æ€§ï¼š

- `elem.tag_name`ï¼šå…ƒç´ çš„æ ‡ç­¾åï¼Œå¯ä»¥é‡æ–°èµ‹å€¼ã€‚
- `elem.attributes`ï¼šä¸€ä¸ªè¡¨ï¼Œå­˜å‚¨ç€å…ƒç´ çš„æ‰€æœ‰å±æ€§ï¼Œå¯¹æ­¤è¡¨çš„æ›´æ”¹ä¼šç”Ÿæ•ˆäºå…ƒç´ æœ¬èº«ï¼›ä¸å¯é‡æ–°èµ‹å€¼ã€‚
- `elem.children`ï¼šä¸€ä¸ª [`Fragment`](#acandyfragment)ï¼Œå­˜å‚¨ç€å…ƒç´ çš„æ‰€æœ‰å­ç»“ç‚¹ï¼Œå¯¹æ­¤è¡¨çš„æ›´æ”¹ä¼šç”Ÿæ•ˆäºå…ƒç´ æœ¬èº«ï¼›ä¸å¯é‡æ–°èµ‹å€¼ã€‚
- <code>elem.*some_attribute*</code>ï¼ˆ<code>*some_attribute*</code> ä¸ºå­—ç¬¦ä¸²ï¼‰ï¼šç›¸å½“äº <code>elem.attributes.*some_attribute*</code>ã€‚
- <code>elem[*n*]</code>ï¼ˆ<code>*n*</code> ä¸ºæ•´æ•°ï¼‰ï¼šç›¸å½“äº <code>elem.children[*n*]</code>ã€‚

ä¾‹å­ï¼š

```lua
local elem = a.ol { id="my-id",
   a.li 'item 1',
}

-- get
elem.tag_name  --> 'ol'

elem.children[1]  --> a.li 'item 1'
elem[1] == elem.children[1]  --> true

elem.attributes.id  --> 'my-id'
elem.id == elem.attributes.id  --> true

-- set
elem.tag_name = 'ul'

elem.children:insert(a.li 'item 2')
elem[3] = a.li 'item 3'

elem.attributes.id = 'new-id'
elem.style = 'color: blue;'

print(elem)
```

```html
<ul id="new-id" style="color: blue;">
   <li>item 1</li>
   <li>item 2</li>
   <li>item 3</li>
</ul>
```

## ç»“ç‚¹æ„é€ å™¨

### `acandy.Fragment`

`Fragment` æ‰¿è½½å¤šä¸ªå…ƒç´ ã€‚`Fragment` å’Œæ™®é€šè¡¨çš„ä»…æœ‰çš„åŒºåˆ«å°±æ˜¯ï¼š

- è®¾ç½®äº† `__tostring`ï¼Œå¯ä»¥å¾—åˆ° HTML å­—ç¬¦ä¸²ï¼›
- è®¾ç½®äº† `__index`ï¼Œå¯ä»¥ä»¥ç±»ä¼¼é¢å‘å¯¹è±¡çš„å½¢å¼è°ƒç”¨ `table.insert`ã€`table.remove` ç­‰ `table` åº“ä¸­æ‰€æœ‰ä»¥è¡¨ä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„æ–¹æ³•ã€‚

å¯ä»¥é€šè¿‡ `Fragment()` æˆ– `Fragment({})` åˆ›å»ºä¸€ä¸ªç©ºçš„ Fragmentã€‚

å½“ä»…æœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œ`Fragment(<child>)` ä¸ `Fragment({ <child> })` ç­‰ä»·ã€‚

ä¾‹å­ï¼š

```lua
local Fragment = acandy.Fragment
local frag = Fragment {
   a.p 'First paragraph.',
   a.p 'Second paragraph.',
}
frag:insert(a.p('Third paragraph.'))
print(frag)
```

```html
<p>First paragraph.</p>
<p>Second paragraph.</p>
<p>Third paragraph.</p>
```

### `acandy.Raw`

`Raw` ç”¨äºä½¿å­—ç¬¦ä¸²åœ¨æœ€ç»ˆä¸è¢«è½¬ä¹‰ã€‚å®ƒæ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ï¼Œå¹¶è°ƒç”¨ `tostring`ï¼Œå­˜å‚¨äºå†…éƒ¨ã€‚

- è®¾ç½®äº† `__tostring`ï¼Œå¯ä»¥é€šè¿‡ `tostring` å¾—åˆ°å¯¹åº”å­—ç¬¦ä¸²ï¼›
- è®¾ç½®äº† `__concat`ï¼Œå¯ä»¥é€šè¿‡ `..` è¿æ¥ä¸¤ä¸ªç”± `Raw` å¾—åˆ°çš„å¯¹è±¡ã€‚

ä¾‹å­ï¼š

```lua
local Raw = acandy.Raw
local elem = a.ul {
   a.li 'foo <br> bar',
   a.li(Raw 'foo <br> bar'),
   a.li(Raw('foo <b')..Raw('r> bar')),
   a.li { Raw('foo <b'), Raw('r> bar') },
}
```

```html
<ul>
   <li>foo &lt;br&gt; bar</li>
   <li>foo <br> bar</li>
   <li>foo <br> bar</li>
   <li>foo <br> bar</li>
</ul>
```

### `acandy.Comment`

`Comment` åˆ›å»ºä¸€ä¸ªæ³¨é‡Šç»“ç‚¹ã€‚

```lua
local elem = a.p {
   'Hello, ',
   acandy.Comment 'This is a comment.',
   'world!',
   acandy.Comment(),
}
print(elem)
```

```html
<p>Hello, <!--This is a comment.-->world!<!----></p>
```

### `acandy.Doctype`

ç›®å‰ä»…æ”¯æŒ HTML5 çš„ doctypeï¼Œé€šè¿‡ `Doctype.HTML` è·å–ã€‚

```lua
tostring(acandy.Doctype.HTML)  --> '<!DOCTYPE html>'
```

## ç¯å¢ƒæ–¹æ³•

### `acandy.extend_env`

```lua
function acandy.extend_env(env: table) -> nil
```

ä½¿ç”¨ `acandy.a` ä½œä¸º `__index` æ¥æ‰©å±•ä¼ å…¥çš„ç¯å¢ƒï¼Œä¾‹å¦‚ `_ENV`ã€‚è¿™ä½¿å¾—èƒ½å¤Ÿç›´æ¥ä½¿ç”¨å…ƒç´ åä¸éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ `a.`ï¼Œé™¤éä¸å±€éƒ¨å˜é‡æˆ–å…¨å±€å˜é‡æœ‰å‘½åå†²çªã€‚

> [!WARNING]
>
> ä¸å»ºè®®å¯¹å…¨å±€ç¯å¢ƒä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå› ä¸ºå¯èƒ½ä¼šé€ æˆéš¾ä»¥å¯Ÿè§‰çš„å‘½åå†²çªã€‚

```lua
local acandy = require 'acandy'
local a = acandy.a
acandy.extend_env(_ENV)

print(
   -- normally you can access an element without `a.`
   div {
      -- use `a.table` to avoid the naming conflict with Lua's `table` module (a global value)
      a.table {
         tr { td 'foo' },
      },
      -- or use a different case
      TABLE {
         tr { td 'bar' },
      }
      ul {
         -- use `a.a` to avoid the naming conflict with `a` from `acandy` (a local value)
         li / a.a { href="/home", 'Home' },
         -- or use a different case
         li / A { href="/about", 'About' },
      }
   }
)
```

```html
<div>
   <table>
      <tr><td>foo</td></tr>
   </table>
   <table>
      <tr><td>bar</td></tr>
   </table>
   <ul>
      <li><a href="/home">Home</a></li>
      <li><a href="/about">About</a></li>
   </ul>
</div>
```

### `acandy.to_extended_env`

```lua
function acandy.to_extended_env(env: table) -> table
```

ç±»ä¼¼äº `acandy.extend_env`ï¼Œä½†è¿”å›ä¸€ä¸ªæ–°è¡¨è€Œä¸æ˜¯ä¿®æ”¹åŸè¡¨ã€‚

```lua
-- on Lua 5.2+
local function get_article()
   local _ENV = acandy.to_extended_env(_ENV)
   return (
      article {
         header / h2 'Title',
         main {
            p 'Paragraph 1',
            p 'Paragraph 2',
         }
      }
   )
end
-- on Lua 5.1
local get_article = setfenv(function ()
   return (
      article {
         header / h2 'Title',
         main {
            p 'Paragraph 1',
            p 'Paragraph 2',
         }
      }
   )
end, acandy.to_extended_env(_G))

print(get_article())
```

```html
<article>
   <header>
      <h2>Title</h2>
   </header>
   <main>
      <p>Paragraph 1</p>
      <p>Paragraph 2</p>
   </main>
</article>
```

## æ¦‚å¿µ

### ç±»è¡¨å€¼

ç±»è¡¨ï¼ˆtable-likeï¼‰å€¼æ˜¯æŒ‡å¯ä»¥å½“ä½œè¡¨æ¥è¯»å–çš„å€¼ã€‚

å½“ä¸”ä»…å½“ä¸€ä¸ªå€¼ `t` ç¬¦åˆä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œè¯¥å€¼è¢«è®¤ä¸ºæ˜¯ç±»è¡¨å€¼ï¼š

- æ»¡è¶³ä»»æ„ä¸€æ¡ï¼š

  - `t` æ˜¯ä¸€ä¸ªè¡¨ï¼Œä¸”æœªè®¾ç½®å…ƒè¡¨ã€‚
  - `t` çš„å…ƒè¡¨çš„ `'__acandy_table_like'` å­—æ®µä¸º `true`ï¼ˆå¯é€šè¿‡ `getmetatable(t).__acandy_table_like = true` è®¾ç½®ï¼‰ã€‚ä½¿ç”¨è€…éœ€è¦ç¡®ä¿ `t` èƒ½å¤Ÿï¼š

    - é€šè¿‡ `t[k]` è¯»å–å†…å®¹ï¼›
    - é€šè¿‡ `#t` è·å–åºåˆ—é•¿åº¦ï¼›
    - é€šè¿‡ `pairs(t)` å’Œ `ipairs(t)` éå†é”®å€¼ã€‚

    ACandy ä»…æ£€æŸ¥å…ƒè¡¨ `'__acandy_table_like'` å­—æ®µï¼Œä¸ä¼šæ£€æŸ¥ `t` æ˜¯å¦æ»¡è¶³ä¸Šè¿°æ¡ä»¶ã€‚

### ç±»åˆ—è¡¨å€¼

ç±»åˆ—è¡¨ï¼ˆlist-likeï¼‰å€¼æ˜¯æŒ‡å¯ä»¥å½“ä½œåºåˆ—æ¥è¯»å–çš„å€¼ã€‚

å½“ä¸”ä»…å½“ä¸€ä¸ªå€¼ `t` ç¬¦åˆä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œè¯¥å€¼è¢«è®¤ä¸ºæ˜¯ç±»åˆ—è¡¨å€¼ï¼š

- æ»¡è¶³ä»»æ„ä¸€æ¡ï¼š

  - `t` æ˜¯ä¸€ä¸ª[ç±»è¡¨å€¼](#ç±»è¡¨å€¼)ã€‚
  - `t` çš„å…ƒè¡¨çš„ `'__acandy_list_like'` å­—æ®µä¸º `true`ï¼ˆå¯é€šè¿‡ `getmetatable(t).__acandy_table_like = true` è®¾ç½®ï¼‰ã€‚ä½¿ç”¨è€…éœ€è¦ç¡®ä¿ `t` èƒ½å¤Ÿï¼š

    - é€šè¿‡ `t[k]` è¯»å–å†…å®¹ï¼›
    - é€šè¿‡ `#t` è·å–åºåˆ—é•¿åº¦ï¼›
    - é€šè¿‡ `ipairs(t)` éå†å€¼ã€‚

    ACandy ä»…æ£€æŸ¥å…ƒè¡¨ `'__acandy_list_like'` å­—æ®µï¼Œä¸ä¼šæ£€æŸ¥ `t` æ˜¯å¦æ»¡è¶³ä¸Šè¿°æ¡ä»¶ã€‚

## è´¡çŒ®

æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼åŒ…æ‹¬ä½†ä¸é™äºæ±‡æŠ¥ç¼ºé™·ã€æå‡ºåŠŸèƒ½å»ºè®®ã€å®Œå–„æ–‡æ¡£ã€ä¼˜åŒ–ä»£ç ã€‚
